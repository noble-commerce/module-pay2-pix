<?xml version="1.0"?>
<!--
/**
 * DISCLAIMER
 *
 * Do not edit this file if you want to update this module for future new versions.
 *
 * @category Pay2
 * @package Pay2_Pix
 * @copyright Copyright (c) 2022 NobleCommerce
 * @author NobleCommerce <hello@noblecommerce.io>
 *
 * See LICENSE.md for license details.
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">

    <!-- Gateway -->
    <virtualType name="Pay2\Pix\Virtual\Model\Method\Adapter" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Pay2\Pix\Model\Checkout\ConfigProvider::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Pay2\Pix\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Pay2\Pix\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">Pay2\Pix\Virtual\Gateway\Config\ValueHandlerPool</argument>
            <argument name="commandPool" xsi:type="object">Pay2\Pix\Virtual\Gateway\Command\CommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Config\ValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">Pay2\Pix\Virtual\Gateway\Config\ConfigValueHandler</item>
                <item name="can_void" xsi:type="string">Pay2\Pix\Gateway\Config\Handler\CanVoid</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Config\ConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Pay2\Pix\Gateway\Config\Config</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Command\CommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">Pay2\Pix\Virtual\Gateway\Command\AuthorizeCommand</item>
                <item name="notification" xsi:type="string">Pay2\Pix\Virtual\Gateway\Command\NotificationCommand</item>
                <item name="refund" xsi:type="string">Pay2\Pix\Virtual\Gateway\Command\RefundCommand</item>
                <item name="void" xsi:type="string">Pay2\Pix\Virtual\Gateway\Command\RefundCommand</item>
                <item name="cancel" xsi:type="string">Pay2\Pix\Virtual\Gateway\Command\RefundCommand</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Command Manager -->
    <virtualType name="Pay2\Pix\Virtual\Gateway\Command\CommandManager" type="Magento\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">Pay2\Pix\Virtual\Gateway\Command\CommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Logger -->
    <virtualType name="Pay2\Pix\Virtual\Gateway\Logger" type="Magento\Payment\Model\Method\Logger">
        <arguments>
            <argument name="config" xsi:type="object">Pay2\Pix\Gateway\Config\Config</argument>
            <argument name="logger" xsi:type="object">Pay2\Pix\Virtual\Logger</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Logger" type="Magento\Framework\Logger\Monolog">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="critical" xsi:type="object">Pay2\Pix\Logger\Handler\Critical</item>
                <item name="debug" xsi:type="object">Pay2\Pix\Logger\Handler\Debug</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Client -->
    <virtualType name="Pay2\Pix\Virtual\Gateway\Http\Client" type="Magento\Payment\Gateway\Http\Client\Zend">
        <arguments>
            <argument name="logger" xsi:type="object">Pay2\Pix\Virtual\Gateway\Logger</argument>
            <argument name="converter" xsi:type="object">Pay2\Pix\Gateway\Converter\JsonToArray</argument>
        </arguments>
    </virtualType>

    <!-- Authorize -->
    <virtualType name="Pay2\Pix\Virtual\Gateway\Command\AuthorizeCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Pay2\Pix\Virtual\Gateway\Request\AuthorizeRequestBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Pay2\Pix\Gateway\Http\TransferFactory\Authorize</argument>
            <argument name="client" xsi:type="object">Pay2\Pix\Virtual\Gateway\Http\Client</argument>
            <argument name="validator" xsi:type="object">Pay2\Pix\Gateway\Validator\AuthorizeResponse</argument>
            <argument name="handler" xsi:type="object">Pay2\Pix\Virtual\Gateway\Response\AuthorizeHandler</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Request\AuthorizeRequestBuilder" type="Pay2\Pix\Gateway\Request\RequestBuilder">
        <arguments>
            <argument name="builder" xsi:type="object">Pay2\Pix\Virtual\Gateway\Request\AuthorizeBuilderComposite</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Request\AuthorizeBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="payer" xsi:type="string">Pay2\Pix\Gateway\Request\Builder\Payer</item>
                <item name="shipping" xsi:type="string">Pay2\Pix\Gateway\Request\Builder\Shipping</item>
                <item name="payment" xsi:type="string">Pay2\Pix\Gateway\Request\Builder\Payment</item>
                <item name="items" xsi:type="string">Pay2\Pix\Gateway\Request\Builder\Items</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Response\AuthorizeHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="save_details" xsi:type="string">Pay2\Pix\Gateway\Response\Handler\SaveDetails</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Notification -->
    <virtualType name="Pay2\Pix\Virtual\Gateway\Command\NotificationCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Pay2\Pix\Virtual\Gateway\Request\NotificationRequestBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Pay2\Pix\Gateway\Http\TransferFactory\Info</argument>
            <argument name="client" xsi:type="object">Pay2\Pix\Virtual\Gateway\Http\Client</argument>
            <argument name="validator" xsi:type="object">Pay2\Pix\Gateway\Validator\InfoResponse</argument>
            <argument name="handler" xsi:type="object">Pay2\Pix\Virtual\Gateway\Response\NotificationHandler</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Request\NotificationRequestBuilder" type="Pay2\Pix\Gateway\Request\RequestBuilder">
        <arguments>
            <argument name="builder" xsi:type="object">Pay2\Pix\Virtual\Gateway\Request\NotificationBuilderComposite</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Request\NotificationBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">Pay2\Pix\Gateway\Request\Builder\Info</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Response\NotificationHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="update_status" xsi:type="string">Pay2\Pix\Gateway\Response\Handler\UpdateStatus</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Refund -->
    <virtualType name="Pay2\Pix\Virtual\Gateway\Command\RefundCommand" type="Magento\Payment\Gateway\Command\GatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Pay2\Pix\Virtual\Gateway\Request\RefundRequestBuilder</argument>
            <argument name="transferFactory" xsi:type="object">Pay2\Pix\Gateway\Http\TransferFactory\Refund</argument>
            <argument name="client" xsi:type="object">Pay2\Pix\Virtual\Gateway\Http\Client</argument>
            <argument name="validator" xsi:type="object">Pay2\Pix\Gateway\Validator\RefundResponse</argument>
            <argument name="handler" xsi:type="object">Pay2\Pix\Virtual\Gateway\Response\RefundHandler</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Request\RefundRequestBuilder" type="Pay2\Pix\Gateway\Request\RequestBuilder">
        <arguments>
            <argument name="builder" xsi:type="object">Pay2\Pix\Virtual\Gateway\Request\RefundBuilderComposite</argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Request\RefundBuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="operation" xsi:type="string">Pay2\Pix\Gateway\Request\Builder\Refund</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Pay2\Pix\Virtual\Gateway\Response\RefundHandler" type="Magento\Payment\Gateway\Response\HandlerChain">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="refund_status" xsi:type="string">Pay2\Pix\Gateway\Response\Handler\RefundStatus</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Arguments -->
    <type name="Magento\Payment\Gateway\Command\CommandManagerPool">
        <arguments>
            <argument name="executors" xsi:type="array">
                <item name="pay2_pix" xsi:type="string">Pay2\Pix\Virtual\Gateway\Command\CommandManager</item>
            </argument>
        </arguments>
    </type>

    <type name="Pay2\Pix\Gateway\Config\Config">
        <arguments>
            <argument name="valueHandlerPool" xsi:type="object">Pay2\Pix\Virtual\Gateway\Config\ValueHandlerPool</argument>
            <argument name="methodCode" xsi:type="const">Pay2\Pix\Model\Checkout\ConfigProvider::CODE</argument>
        </arguments>
    </type>

    <type name="Pay2\Pix\Controller\Notifications\Callback">
        <arguments>
            <argument name="logger" xsi:type="object">Pay2\Pix\Virtual\Logger</argument>
        </arguments>
    </type>

    <!-- Plugins -->
    <type name="Magento\Framework\App\Request\CsrfValidator">
        <plugin name="pay2_pix_app_request_skip_csrf_validator" type="Pay2\Pix\Plugin\App\Request\SkipCsrfValidator" />
    </type>

    <type name="Magento\Sales\Model\Order\Payment\State\CommandInterface">
        <plugin name="pay2_pix_sales_model_order_payment_state_set_order_status" type="Pay2\Pix\Plugin\Sales\Model\Order\Payment\State\SetOrderStatus"/>
    </type>

</config>
